## ğŸ§© [Session 4 ì¶”ê°€ ì‹¤ìŠµ] ì˜¤ë””ì˜¤ íŒŒì¼ë¡œ íšŒì˜ë¡ ìë™ ìƒì„±í•˜ê¸°

> **ì‹¤ìŠµ ëª©í‘œ**
>
>   * ë‹¨ìˆœ í…ìŠ¤íŠ¸ ì²˜ë¦¬ë¥¼ ë„˜ì–´, **ë©€í‹°ëª¨ë‹¬(Audio -\> Text)** ì²˜ë¦¬ ëŠ¥ë ¥ì„ ë°°ì›ë‹ˆë‹¤.
>   * OpenAIì˜ \*\*Whisper ëª¨ë¸(STT)\*\*ê³¼ \*\*GPT ëª¨ë¸(LLM)\*\*ì„ ì—°ì‡„ì ìœ¼ë¡œ í™œìš©í•©ë‹ˆë‹¤.
>   * ë…¹ìŒ íŒŒì¼ í•˜ë‚˜ë§Œ ë˜ì§€ë©´ [ìš”ì•½-í• ì¼-ì¼ì •]ì´ ì •ë¦¬ë˜ì–´ ë…¸ì…˜(Notion)ì´ë‚˜ ìŠ¬ë™(Slack)ìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” íë¦„ì„ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

-----

### 1\. ì›Œí¬í”Œë¡œìš° ì „ì²´ íë¦„ (Flow)

ì´ ì›Œí¬í”Œë¡œìš°ëŠ” \*\*ë“£ê³ (Listen) -\> ì“°ê³ (Transcribe) -\> ìš”ì•½(Summarize)\*\*í•˜ëŠ” 3ë‹¨ê³„ë¡œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.

1.  **Trigger:** ì˜¤ë””ì˜¤ íŒŒì¼ ê°ì§€ (ì˜ˆ: Telegram ìŒì„± ë©”ì‹œì§€, Google Drive ì—…ë¡œë“œ)
2.  **Action 1 (STT):** OpenAI Whisper ëª¨ë¸ì´ ìŒì„±ì„ í…ìŠ¤íŠ¸ë¡œ ë°›ì•„ì“°ê¸°
3.  **Action 2 (LLM):** ë°›ì•„ì“´ í…ìŠ¤íŠ¸ë¥¼ GPTê°€ ìš”ì•½ ë° êµ¬ì¡°í™”
4.  **Action 3 (Output):** ê²°ê³¼ ì „ì†¡ (Slack, Email ë“±)

-----

### 2\. ë‹¨ê³„ë³„ ì„¤ì • ê°€ì´ë“œ

#### Step 0: Whisper ëª¨ë¸ êµ¬ë™í•˜ê¸°

##### Model ë‹¤ìš´ë¡œë“œ ë° ë¡œë“œ

ì‹¤ìŠµì— ì‚¬ìš©í•  ì˜¤í”ˆì†ŒìŠ¤ whisper ëª¨ë¸ì„ ë¡œë“œí•©ë‹ˆë‹¤.

* **Target Model:** `ggerganov/whisper.cpp`

1. AI Lab ë©”ë‰´ -> **Catalog** ì„ íƒ
2. ëª¨ë¸ ê²€ìƒ‰ì°½ì— `ggerganov/whisper.cpp` ì…ë ¥

##### whisper Model Service ì‹¤í–‰ (Local API Server)

ë‹¤ìš´ë¡œë“œí•œ ëª¨ë¸ì„ n8nì´ ì ‘ì†í•  ìˆ˜ ìˆë„ë¡ API ì„œë²„ë¡œ ë„ì›ë‹ˆë‹¤.

1. AI Lab -> **Services** (ë˜ëŠ” Local Server) íƒ­ í´ë¦­
2. **New Model Service** í´ë¦­ -> ë‹¤ìš´ë¡œë“œí•œ whisper ëª¨ë¸ ì„ íƒ
3. **Container port** ì„ì˜ ì§€ì • (ì˜ˆ: 22222 í¬íŠ¸)
4. **Create Service** í´ë¦­
5. **Open Service Details** í´ë¦­ í›„, **Endpoint í™•ì¸:** `http://host.containers.internal:22222/inference`
* *ì´ ì£¼ì†ŒëŠ” 'OpenAI' ë…¸ë“œì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤.*


#### Step 1: ì˜¤ë””ì˜¤ íŒŒì¼ (Trigger)

ì‹¤ìŠµ í¸ì˜ë¥¼ ìœ„í•´ **Google Drive**ë‚˜ **Telegram**ì„ ë§ì´ ì‚¬ìš©í•©ë‹ˆë‹¤. ì§€ë‚œ ì‹œê°„ ì—°ë™í•´ë‘” **Google Drive**ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. (ë˜ëŠ” ë¡œì»¬ íŒŒì¼ì„ ì½ëŠ” `Read Binary File` ë…¸ë“œë„ ì‚¬ìš© ê°€ëŠ¥)

  * **Node:** `Google Drive` Trigger
  * **On changes involving a specific folder**
  * **Folder:** `From list` ì—ì„œ ê¶Œí•œ ìˆëŠ” folder ì„ íƒ. (ì˜¤ë””ì˜¤ìš© í´ë” ì„ íƒ)
  * **Options:**
      * File Type: `Audio` ì„ íƒ
      * **í•µì‹¬:** ì˜¤ë””ì˜¤ íŒŒì¼ì€ n8n ë‚´ë¶€ì—ì„œ **Binary Data**ë¡œ ì²˜ë¦¬ë¨ì„ ì´í•´í•´ì•¼ í•©ë‹ˆë‹¤.

#### Step 2: ì˜¤ë””ì˜¤ íŒŒì¼ ê°€ì ¸ì˜¤ê¸° (Download file)
* **Google Drive Download** ë…¸ë“œì—ì„œ 'Operation` ì„ **Download** ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
    * **File:** ì€ `By ID` ë¡œ ì„ íƒí•œ ë’¤, {{ $json.id }} í‘œí˜„ì‹ìœ¼ë¡œ File ì„ ë‹¤ìš´ë¡œë“œ ë°›ê²Œ ë©ë‹ˆë‹¤.
    * *Put Output File in Field:* ëŠ” `data` ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ë°”ì´ë„ˆë¦¬ë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤.
    * mp3 íŒŒì¼ë¡œ ëœ ëŒ€í™” ë ˆì½”ë”© íŒŒì¼ì„ ì¤€ë¹„í•˜ì„¸ìš”.

#### Step 3: ìŒì„±ì„ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜ (Whisper API)

ì‚¬ëŒì˜ ê·€ ì—­í• ì„ í•˜ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤.

* **Node:** `HTTP Request`
* **Method:** `POST`
* **URL:** `http://host.containers.internal:22222/inference` (Podmanì—ì„œ í™•ì¸í•œ í¬íŠ¸)
* **Send Body:** `On` ì¼œê¸°
* **Body Content Type:** `Form-Data` **(ì¤‘ìš”!)**
* API ì„œë²„ë¡œ íŒŒì¼ì„ ì „ì†¡í•  ë•ŒëŠ” ë°˜ë“œì‹œ ì´ ì˜µì…˜ì„ ì¨ì•¼ í•©ë‹ˆë‹¤.

* **Body Parameters:**
* **file:** `data`
    * **Parameter Type:** `n8n Binary File`
    * **Parameter Name:** `file` (API ë¬¸ì„œì—ì„œ ìš”êµ¬í•˜ëŠ” íŒŒì¼ í•„ë“œëª… í™•ì¸ í•„ìˆ˜)
    * **Input Data Field:** Step 1ì—ì„œ ë„˜ì–´ì˜¨ ë°”ì´ë„ˆë¦¬ ë°ì´í„° ì†ì„±ëª…: `data`
* **language:** `ko`
    * **Parameter Type:** `Form Data`
    * **Parameter Name:** `language`
    * **Value:** `ko`
* **translate:** `false` 
    * **Parameter Type:** `Form Data`
    * **Parameter Name:** `translate`
    * **Value:** `false`


#### Step 4: íšŒì˜ë¡ ìš”ì•½ ë° êµ¬ì¡°í™” (LLM)

ë‹¨ìˆœíˆ ë°›ì•„ì“´ ê¸€ì€ ì¤„ê¸€ì´ë¼ ì½ê¸° í˜ë“­ë‹ˆë‹¤. ì´ë¥¼ ê¹”ë”í•˜ê²Œ ì •ë¦¬í•©ë‹ˆë‹¤.

  * **Node:** `Basic LLM Chain`
  * **Prompt (System):**
    ```text
    ë„ˆëŠ” ì „ë¬¸ ì†ê¸°ì‚¬ì´ì í”„ë¡œì íŠ¸ ë§¤ë‹ˆì €ì•¼.
    ì‚¬ìš©ìê°€ ì œê³µí•˜ëŠ” 'íšŒì˜ ìŠ¤í¬ë¦½íŠ¸'ë¥¼ ì½ê³  ì•„ë˜ í˜•ì‹ì— ë§ì¶° Markdownìœ¼ë¡œ ì •ë¦¬í•´ì¤˜.

    ## 1. íšŒì˜ ê°œìš”
    - ì£¼ì œ: (ë‚´ìš© ìœ ì¶”)
    - ë¶„ìœ„ê¸°: (ëŒ€í™” í†¤ì„ ë³´ê³  ìœ ì¶”)

    ## 2. 3ì¤„ ìš”ì•½
    -
    -
    -

    ## 3. Action Items (í•  ì¼)
    - [ë‹´ë‹¹ì] í•  ì¼ ë‚´ìš© (ê¸°í•œ)
    ```
  * **Prompt (User):** Expression ëª¨ë“œ ì‚¬ìš©
      * `{{ $json.text }}` (ì´ì „ Whisper ë…¸ë“œì—ì„œ ë‚˜ì˜¨ í…ìŠ¤íŠ¸ ê²°ê³¼)

  * **Node ì¶”ê°€ ë° ì—°ê²°** `OpenAI Chat Model`


#### Step 5: ê²°ê³¼ ë‚´ë³´ë‚´ê¸°

* **Node:** `Send Email` or `Slack`
* **Subject (Expression):** `[n8n ì•Œë¦¬ë¯¸] íšŒì˜ ë…¹ìŒë³¸ {{$('Download file').item.json.name}} ìš”ì•½ ì •ë¦¬`
* **HTML (Expression):** Step 3(LLM)ì—ì„œ ë‚˜ì˜¨ text ë¥¼ í¬í•¨í•œ ì•„ë˜ë‚´ìš©ì„ `HTML` ì— ë„£ìŠµë‹ˆë‹¤.
  ```html
  {{$('Download file').item.json.name}} : https://drive.google.com/file/d/{{ $('Download file').item.json.id }}
  <br>
  <pre>
  {{ $json.text }}
  </pre>
  ```

-----

### 3\. ì‹¤ìŠµ ê¿€íŒ (Troubleshooting)

**Q. ì˜¤ë””ì˜¤ íŒŒì¼ì´ ë„ˆë¬´ í¬ë©´ ì–´ë–»ê²Œ í•˜ë‚˜ìš”?**

> A. Whisper APIëŠ” íŒŒì¼ í¬ê¸° ì œí•œ(ì•½ 25MB)ì´ ìˆìŠµë‹ˆë‹¤. ì‹¤ìŠµ ë•ŒëŠ” 1\~2ë¶„ ë‚´ì™¸ì˜ ì§§ì€ ë…¹ìŒ íŒŒì¼ì´ê³  `mp3` í¬ë§·(ì••ì¶•ë¥  ì¢‹ìŒ)ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

**Q. ì‚¬íˆ¬ë¦¬ë‚˜ ì „ë¬¸ ìš©ì–´ë„ ì•Œì•„ë“£ë‚˜ìš”?**

> A. ë„¤, ìƒê°ë³´ë‹¤ ë§¤ìš° ì˜ ì•Œì•„ë“£ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ê³ ìœ ëª…ì‚¬(íšŒì‚¬ ì´ë¦„, í”„ë¡œì íŠ¸ ì½”ë“œëª…)ëŠ” í”„ë¡¬í”„íŠ¸ì— ë¯¸ë¦¬ "ì´ íšŒì˜ì—ëŠ” 'n8n', 'LangChain' ê°™ì€ ë‹¨ì–´ê°€ ìì£¼ ë“±ì¥í•´"ë¼ê³  íŒíŠ¸ë¥¼ ì£¼ë©´ ì •í™•ë„ê°€ ì˜¬ë¼ê°‘ë‹ˆë‹¤.

-----
