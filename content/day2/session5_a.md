
## ğŸ§© [Session 5 ì‹¬í™” ì‹¤ìŠµ] ì—ì´ì „íŠ¸ê°€ ì“´ ê¸€ì„ 'ê°ìˆ˜'í•˜ëŠ” Supervisor ë§Œë“¤ê¸°

(ì‹œê°„ì´ í—ˆë½í•œë‹¤ë©´ ì§„í–‰í•˜ëŠ” ê³ ê¸‰ ê³¼ì •)

ì—ì´ì „íŠ¸ê°€ ì‘ì„±í•œ ë¦¬í¬íŠ¸ë¥¼ ë°”ë¡œ ë³´ë‚´ì§€ ì•Šê³ , \*\*ë‘ ë²ˆì§¸ LLM(íŒ€ì¥ ì—­í• )\*\*ì´ ê²€í† í•˜ëŠ” íë¦„ì…ë‹ˆë‹¤.

1.  **Agent 1 (ì£¼ë‹ˆì–´):** ë¦¬í¬íŠ¸ ì‘ì„± -\> ì¶œë ¥.
2.  **LLM Node (ì‹œë‹ˆì–´/íŒ€ì¥):**
      * ì…ë ¥: Agent 1ì˜ ê¸€.
      * í”„ë¡¬í”„íŠ¸: "ì´ ê¸€ì˜ íŒ©íŠ¸ ì²´í¬ì™€ í†¤ì•¤ë§¤ë„ˆë¥¼ ì ê²€í•´. ë§Œì•½ ë¶€ì¡±í•˜ë©´ 'REJECT', ê´œì°®ìœ¼ë©´ 'APPROVE'ë¼ê³  ì¶œë ¥í•´."
3.  **Switch Node (ë¶„ê¸°):**
      * `REJECT`ì¼ ê²½ìš° â†’ ë‹¤ì‹œ Agent 1ì—ê²Œ ìˆ˜ì • ìš”ì²­(Loop back).
      * `APPROVE`ì¼ ê²½ìš° â†’ Slack ì „ì†¡.

-----

### Step 1: ë„êµ¬(Tools) ì¤€ë¹„ (Agentì˜ ì†ê³¼ ë°œ)

ì—ì´ì „íŠ¸ ë…¸ë“œì— ì—°ê²°í•  3ê°€ì§€ ë„êµ¬ë¥¼ ì¤€ë¹„í•©ë‹ˆë‹¤. 3ê°€ì§€ ëª¨ë‘ `Call n8n Workflow` ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë¸Œ ì›Œí¬í”Œë¡œìš°ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.

1.  **google_search (ê²€ìƒ‰):**
      * `Google Search` ë…¸ë“œ ì—°ê²°.
      * *ìš©ë„:* ìµœì‹  ì •ë³´ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ê¸ì–´ì˜¤ëŠ” ì—­í• .
2.  **web_scraper (ì½ê¸°):**
      * `HTTP Request` ì™€ `HTML` (HTML -\> Text ë³€í™˜) ë…¸ë“œ ì—°ê²°.
      * *ìš©ë„:* ê²€ìƒ‰ëœ URLì˜ ìƒì„¸ ë³¸ë¬¸ì„ ì½ëŠ” ì—­í• .
3.  **email_sender (ë³´ê³ ):**
      * `Send Email` ë…¸ë“œ ì—°ê²°.
      * *ìš©ë„:* ë³´ê³ ì„œë¥¼ ì œì¶œí•˜ëŠ” ì—­í• .

#### Step 1.3: Sub_Send_Email_Report ì„œë¸Œ ì›Œí¬í”Œë¡œìš° ë§Œë“¤ê¸°

AIê°€ í˜¸ì¶œí•  'ì‹¬ë¶€ë¦„ì„¼í„°(Sub Workflow)' **Sub_Send_Email_Report** ë¥¼ ë§Œë“­ë‹ˆë‹¤.

1.  **ìƒˆ ì›Œí¬í”Œë¡œìš° ìƒì„±:**

* n8n ëŒ€ì‹œë³´ë“œì—ì„œ `Add workflow`ë¥¼ ëˆŒëŸ¬ `Sub_Send_Email_Report` workflow ë¥¼ ë§Œë“­ë‹ˆë‹¤.
**[ë…¸ë“œ êµ¬ì„±]**
`Execute Workflow Trigger` â†’ **`Send Email`**

2.  **Trigger ì„¤ì •:**

* ë…¸ë“œ ê²€ìƒ‰ì°½ì— `Execute Workflow Trigger`ë¥¼ ê²€ìƒ‰í•˜ì—¬ ì¶”ê°€í•©ë‹ˆë‹¤.
    * **Fields:**
    * `text` (ë³¸ë¬¸ ë‚´ìš©)
    * `subject` (ë©”ì¼ ì œëª©) **â† ì¶”ê°€!**

3.  **Action ì„¤ì •:**

* `Send Email` ë…¸ë“œë¥¼ ì¶”ê°€í•˜ê³  Triggerì™€ ì—°ê²°í•©ë‹ˆë‹¤.
    * `From` ê³¼ `To` Email ì„ ëª¨ë‘ ìì‹ ì˜ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•œë‹¤.
    * **Subject:** (Expression ëª¨ë“œ)
      ```javascript
      {{ $json.subject }}
      ```
    * **HTML:** (Expression ëª¨ë“œ)
      ```javascript
      {{ $json.text }}
      ```

4.  **ì €ì¥(Save):**

* **ì €ì¥** í•©ë‹ˆë‹¤.

### Step 2: User Message (ì‚¬ìš©ì ì…ë ¥) **(ì¶”ê°€)**

> **ì—­í• :** ì²˜ìŒ ì‹¤í–‰ì¸ì§€, í”¼ë“œë°±ì„ ë°›ê³  ì¬ì‹¤í–‰í•˜ëŠ” ê²ƒì¸ì§€ **ë™ì ìœ¼ë¡œ ì…ë ¥**ì„ ë„£ì–´ì£¼ëŠ” ë¶€ë¶„ì…ë‹ˆë‹¤.
> n8nì˜ User Message ë¥¼ **Define Below** ë¡œ ë³€ê²½í•˜ê³  ì•„ë˜ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.

ì´ ì½”ë“œëŠ” **"í”¼ë“œë°±ì´ ìˆìœ¼ë©´ í”¼ë“œë°±ì„ í¬í•¨í•´ì„œ ëª…ë ¹í•˜ê³ , ì—†ìœ¼ë©´ ì›ë˜ ì§ˆë¬¸ë§Œ ë˜ì§€ëŠ”"** ë¡œì§ì…ë‹ˆë‹¤.

```javascript
// n8n Expression ëª¨ë“œ
{{ 
  $json.feedback ? 
  "### [ì¬ì‘ì„± ìš”ì²­]\níŒ€ì¥ë‹˜ì´ ë‹¹ì‹ ì˜ ì§€ë‚œ ë¦¬í¬íŠ¸ë¥¼ ë°˜ë ¤í–ˆìŠµë‹ˆë‹¤.\n\n[ë°˜ë ¤ ì‚¬ìœ (í”¼ë“œë°±)]\n" + $json.feedback + "\n\n[ì›ë˜ ìš”ì²­]\n" + $json.original_query + "\n\nìœ„ í”¼ë“œë°±ì„ ë°˜ì˜í•˜ì—¬ ë” ì™„ë²½í•œ ë¦¬í¬íŠ¸ë¥¼ ë‹¤ì‹œ ì‘ì„±í•˜ì„¸ìš”." : 
  "### [ì‹ ê·œ ìš”ì²­]\n" + ($json.query || $json.message) + "\n\nìœ„ ê¸°ì—…ì— ëŒ€í•œ íˆ¬ì ë¶„ì„ ë¦¬í¬íŠ¸ë¥¼ ì‘ì„±í•˜ì„¸ìš”." 
}}
{{ $json.chatInput }}
```

*(ì°¸ê³ : `$json.feedback` ë³€ìˆ˜ëŠ” Supervisor(Agent 2)ê°€ ë°˜ë ¤í–ˆì„ ë•Œ ë£¨í”„ë¥¼ íƒ€ê³  ë„˜ì–´ì˜¤ëŠ” ë°ì´í„° ë³€ìˆ˜ëª…ì— ë§ì¶° ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤.)*

---

### Step 3: ë©”ì¸ ì›Œí¬í”Œë¡œìš°ì— email_sender ì—°ê²°í•˜ê¸° (ë„êµ¬ ì¥ì—¬ì£¼ê¸°)

1.  **ë„êµ¬ ì¶”ê°€:**

* `AI Agent` ë…¸ë“œì˜ **Tools** í•­ëª©ì—ì„œ `+` ë²„íŠ¼ì„ ëˆ„ë¦…ë‹ˆë‹¤.
* `Call n8n Workflow Tool` ì„ ì„ íƒí•©ë‹ˆë‹¤.

2.  **ë„êµ¬ ì„¤ì •:**

* **Source:** `Database` ì„ íƒ
* **Workflow:** `Sub_Send_Email_Report`ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
* **Workflow Inputs:** `text` ì™€ `subject` ì˜¤ë¥¸ìª½ì˜ ë°˜ì§ì´ëŠ” ë³„ ì•„ì´ì½˜ì„ ëˆ„ë¦…ë‹ˆë‹¤.
* **Name:** `email_sender`
* **Description (ì„¤ëª…ì„œ):**
    ```text
    Use this tool to send a final report via email.
    The input must be a JSON object with "subject" and "text" fields.
    Example: { "subject": "Nvidia Analysis Report", "text": "Here is the summary..." }
    ```

